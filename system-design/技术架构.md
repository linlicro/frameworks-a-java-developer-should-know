# 可参考的技术架构

一套可直接落地、基于开源、成本低、可快速搭建的框架及架构方案。

## 概要

**框架** 工欲善其事，必先利其器。

* 集中式缓存 Redis
* 消息队列 RabbitMQ、RocketMQ、Kafka
* 集中式日志 ELK
* 任务调度 Job
* 应用监控 Metrics，"没有度量就没有提升" Metrics + InfluxDB + Grafana
* 微服务框架 Dubbo
* 搜索服务 Solr
* 发布工具 Jenkins
* 生产环境诊断工具 Arthas
* 更多 分布式协调器Zk，ORM框架

**架构** 会用框架的猿不一定是架构师，要提升架构设计思想。

* 企业总体架构，在技术、业务、管理之间游刃有余地切换，包括业务架构、应用架构、数据架构和技术架构。
* 应用架构设计，如同施工图纸，从功能需求到用例、用例活动图、领域图、架构分层、核心代码。职责、边界、应用关系、储存、部署就是核心。

**公共应用** 具有一定的独立性，一般自主研发。

* 单点登录 SSO
* 企业支付网关
* CTI通信网关(短信、邮件、微信)

**进阶** 从架构到管理，实现技术架构与组织架构的对齐。

## 架构

### 企业总体架构

企业总体架构包括

* 商务模型 即公司怎么赚钱，主体是什么，竞品分析，组织架构，业务流程
* 架构现状 功能架构、应用架构、数据设计和物理架构
  * 功能架构 包括功能、角色和权限
  * 应用架构 架构图、Web应用现状、作业小应用和接口架构
  * 数据设计 E-R图来表示，高层的E-R图不会变化，是根据业务模型而定的
  * 物理架构 IDC机房、机房之前的访问关系、机房内服务器物理部署图、机房与业务分布、网站架构、数据库架构、集群清单和域名清单
* 领域模型 概念、职责、边界、交互；先确认职责和边界，交互就会清晰
  * 业务、功能需求 + 用例图 + 用例活动图  => 领域模型
* 架构规划
  * 顶层架构规划，一张俯视图 - 功能 > 业务操作 > 数据；剖面图 - 应用 > 服务和框架 > 基础设施数据中心
  * 功能规划
  * 应用规划
  * SOA规划 就是接口规划
  * 分层架构 仓储层(Repository Layer)、领域层(Domain Layer)、应用服务层(Application Layer)、表现层(Presentation Layer)和基础服务层(Infratructure Layer)
  * 数据库规划
  * 物理规划
  * 其他 源代码管理规划、文档管理规划、技术选型和分工

### 架构实施

思路: 树目标、给地图、立榜样、抓重点、造文化、建制度、整环境、组建架构部。

建议: SOA服务化、基础设施平台化、公共业务服务化、加强项目概要设计 及评审。

具体计划是: Roadmap分步实施，改造1期、改造2期、改造3期，近细远粗，实事求是，逐步细化，逐步完善。

企业总体架构，参考开放组体系结构框架（TOGAF）。

## 架构设计

架构设计 要不要做？怎么做？

### 应用架构设计

输入: PRD(产品需求文档)
输出: 架构设计文档
中间: 处理过程和工具

过程和工具:

* 设计的目标和思路
* 功能设计 -- 用例视图、用例后动图；
* 应用 -- 边界、逻辑架构、结构、领域图；
* 数据储存；
* 物理架构、安装部署；
* 非功能设计。

输出: 设计说明书。

### 应用架构设计案例

1. PRD => 功能清单
2. 用例图(关注业务逻辑)，展开到 用例多动图(关注业务逻辑，技术视角)
3. 领域图，从用例活动图演化而来
4. 接口设计
5. 分层设计
6. 代码实现
7. 其他设计项，数据库设计(E-R图 和 表设计)、物理结构设计(应用集群、应用部署图、域名等)、非功能性设计(性能、可用性、伸缩性、扩展性、安全性等)。

## 更多知识探讨

### 1. 关于设计表述

一定要有架构设计文档吗？设计文档保存吗？设计文档为谁服务？设计可以省略吗？

### 2. 关于 UML

UML图 主要有用例图、时序图、活动图、类图、状态图、组件图和部署图，是设计表述和建模工具，容易达成一致的理解(较与 文字描述)。

### 3. 关于 设计模式

设计模式是代码的形状，是代码结构设计的招式，是练功的套路，如同书是人类进步的阶梯。但练功是练功，打架是打架，真正的功夫要在大规模实战中所得。

### 4. 关于 设计原则

* 单一职责原则(SRP): 一个类只承担一种类型的责任，一次只做一件事。
* 开闭原则(OCP): 对扩展开放，对修改关闭。 -- 理想主义
* 里氏代换原则(LSP): 任何基类可以出现的地方，子类一定可以出现。 -- 一个建议或约定
* 接口隔离原则(ISP): 不能强迫用户去依赖那些他们不适用的接口
* 依赖倒置原则(DIP): 高层模块不应该依赖底层模块，都应该依赖抽象。

### 5. 关于 DDD

DDD 是 Domain Driven Design的缩写，就是领域驱动设计，核心是领域模型。
